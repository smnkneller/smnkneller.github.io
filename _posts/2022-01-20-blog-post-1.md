---
title: 'IoT platform switching: From Conrad Connect to iobroker'
date: 2022-01-20
permalink: /posts/2022/01/blog-post-1/
tags:
  - IoT
  - iobroker
  - smart Home
  - homematic IP
---

In our research project [Smart Air](https://www.esentri.com/smart-air-intelligente-system-behaglichkeit-haus/) we were forced to get rid of [Conrad Connect IoT platform](https://conradconnect.com/de). Why? To our annoyance they just shot it down - and announced the shut down just one month in advance! In this post I'll describe what had to be done to migrate to the open source [IoT platform iobroker](https://www.iobroker.net/) and why I'm actually happy about this forced IoT platform switching.

Our Starting Point
======
Within the research project [Smart Air](https://www.esentri.com/smart-air-intelligente-system-behaglichkeit-haus/) we are trying to develop an AI based control of a ventilation system with integrated dehumidification for residential houses. Therefore we collected and are still collecting data of a reference house with a standard ventilation system. This data is measured by serveral sensors from [Homematic IP](https://homematic-ip.com/de) placed in each room of the reference house as well as outside the house. As Homematic IP was partnering with Conrad Connect we did not really question which IoT platform would be the right one for our needs and just accepted the costs for Conrad Connect (round about 1000€ per year for our project size). We built the following infrastucture:


![Architecture Conrad Connect](/images/post1_architecture_old.png)

As you can see all the data from the different sensors within the reference house is consolidated via the Homematic IP access point. From there it is sent over the internet to two Clouds: Homematic Cloud and Conrad Connect. With the Homematic Cloud the homematic Application is fed with real time data, so you can check the sensor values with your smartphone from whereever you are. But thats just for the real time data and you don't get your data outside the application! So we were looking for a way to store the data into a database and Homematic support led as to their partner Conrad Connect. Within Conrad Connect we found a way to do an API Call to our AWS API Gateway on every sensor change. This was not very convenient as for every sensor you have to do some drag & drop within Conrad Connects UI as well as add your put call. So no looping over the sensors and no versioning of the code which is quite a disadvantage but however it worked and we got our data to our familiar AWS world where we could store, process and visualize it as well as develop our AI based control of the ventilation system.

IoT-Plattform requirements
======
When Conrad Connect announced their shut down I was acutally quite surprised as I just didn't expect a subsidiary of the quite large player Conrad Electronics to fail. So I started looking for a replacing IoT-Plattform. Having in mind that I was disappointed by a commercial player together with positive attitude towards open source technologies due to many touchpoints in my Job as a Data Scientist, it was quite clear that I would check out open source alternatives first. So my requirements were the following:
- preferably open source
- easy communication with Homematic IP sensors / Access Point
- possibility to do scripting (not just some GUI)
- preferably python scripting


Well I cound't find an IoT-plattform that fulfilled all of the requirements above but with iobroker I found one that met all the requirements exept for the scripting language which is Javs Script instead of python. 

Migration to iobroker
======
In the following I will describe the migration steps I had to do in order to get keep the data pipeline described above running with iobroker instead of Conrad Connect.

Step1: get iobroker running
------
I got iobroker running on my mac first in order to test it and then I installed in on a raspberry pi, which is both fairly easy as you basically just have to execute the following command within your shell:

```bash
curl -sLf https://iobroker.net/install.sh | bash
```

Step2: Connect iobroker with Homematic IP access point
------

Step3: Implement the logic to send the data to the API gateway
------

Step4: validate my data
------


Advantages of iobroker over Conrad Connect
======
- open source community verison of iobroker. So we save round about 1000€ a year
- code versioning of the javascript code that does the put calls
- full control of the data and when to send it (just changes of the value and not additional timely trigger)
- full control of all data, not just the sensor values Conrad Connect has an implemented maker for
- 

What's next
------

- i don't need the API gateway -> rather run iobroker in ec2 instance and from there directly write into eventbus -> lambdas that listen to the events and process the data -> one securty vulnearability less
- try to do everything as script -> also iobroker environment + adapters + Authentication?